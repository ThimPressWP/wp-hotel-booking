!function(e){function t(e){return Number(e)&&e%1===0}function a(e){return new RegExp("^[-!#$%&'*+\\./0-9=?A-Z^_`a-z{|}~]+@[-!#$%&'*+\\/0-9=?A-Z^_`a-z{|}~]+.[-!#$%&'*+\\./0-9=?A-Z^_`a-z{|}~]+$").test(e)}function n(e){return e=new Date(e),!isNaN(e.getTime())}function i(t){if(!e.isPlainObject(t)){var a=t.match(/<!-- HB_AJAX_START -->(.*)<!-- HB_AJAX_END -->/);try{t=e.parseJSON(a?a[1]:t)}catch(n){t={}}}return t}function o(){var t=e(this),n=e('input[name="existing-customer-email"]');if(!a(n.val()))return n.addClass("error"),void n.focus();t.attr("disabled",!0),n.attr("disabled",!0);var o=e(".hb-col-padding hb-col-border");e.ajax({url:hotel_settings.ajax,dataType:"html",type:"post",data:{action:"hotel_booking_fetch_customer_info",email:n.val()},beforeSend:function(){o.hb_overlay_ajax_start()},success:function(a){if(o.hb_overlay_ajax_stop(),a=i(a),a&&a.ID){var s=e("#hb-order-new-customer");for(var d in a.data){var _=d.replace(/^_hb_customer_/,""),l=s.find('input[name="'+_+'"], select[name="'+_+'"], textarea[name="'+_+'"]');l.val(a.data[d])}s.find('input[name="existing-customer-id"]').val(a.ID),e(".hb-order-existing-customer").fadeOut(function(){})}else r([hotel_booking_i18n.invalid_email]);t.removeAttr("disabled"),n.removeAttr("disabled")},error:function(){o.hb_overlay_ajax_stop(),r([hotel_booking_i18n.ajax_error]),t.removeAttr("disabled"),n.removeAttr("disabled")}})}function r(t){if(0!==t.length){e(".hotel_checkout_errors").slideUp().remove();var a=[];a.push('<div class="hotel_checkout_errors">');for(var n=0;n<t.length;n++)a.push("<p>"+t[n]+"</p>");a.push("</div>"),e("#hb-payment-form h3:first-child").after(a.join(""))}}function s(t){var n=t.find('select[name="title"]'),i=[];-1==n.val()&&(i.push(hotel_booking_i18n.empty_customer_title),n.parents("div:first").addClass("error"));var o=t.find('input[name="first_name"]');o.val()||(i.push(hotel_booking_i18n.empty_customer_first_name),o.parents("div:first").addClass("error"));var s=t.find('input[name="last_name"]');s.val()||(i.push(hotel_booking_i18n.empty_customer_last_name),s.parents("div:first").addClass("error"));var d=t.find('input[name="address"]');d.val()||(i.push(hotel_booking_i18n.empty_customer_address),d.parents("div:first").addClass("error"));var _=t.find('input[name="city"]');_.val()||(i.push(hotel_booking_i18n.empty_customer_city),_.parents("div:first").addClass("error"));var l=t.find('input[name="state"]');l.val()||(i.push(hotel_booking_i18n.empty_customer_state),l.parents("div:first").addClass("error"));var c=t.find('input[name="postal_code"]');c.val()||(i.push(hotel_booking_i18n.empty_customer_postal_code),c.parents("div:first").addClass("error"));var h=t.find('select[name="country"]');h.val()||(i.push(hotel_booking_i18n.empty_customer_country),h.parents("div:first").addClass("error"));var m=t.find('input[name="phone"]');m.val()||(i.push(hotel_booking_i18n.empty_customer_phone),m.parents("div:first").addClass("error"));var u=t.find('input[name="email"]');a(u.val())||(i.push(hotel_booking_i18n.customer_email_invalid),u.parents("div:first").addClass("error"));var f=t.find('input[name="hb-payment-method"]:checked');0==f.length&&(i.push(hotel_booking_i18n.no_payment_method_selected),f.parents("div:first").addClass("error"));var p=t.find('input[name="tos"]');return p.length&&!p.is(":checked")&&(i.push(hotel_booking_i18n.confirm_tos),p.addClass("error")),e('input[name="existing-customer-id"]').val()&&(u.val()!=e('input[name="existing-customer-email"]',t).val()&&i.push(hotel_booking_i18n.customer_email_not_match),u.parents("div:first").addClass("error"),t.find('input[name="existing-customer-id"]').parents("div:first").addClass("error")),i.length>0?(r(i),!1):!0}function d(e){var t="pk_test_HHukcwWCsD7qDFWKKpKdJeOT";"undefined"!=typeof TPBooking_Payment_Stripe&&(t=TPBooking_Payment_Stripe.stripe_publish);var a=StripeCheckout.configure({key:t,image:"https://stripe.com/img/documentation/checkout/marketplace.png",locale:"auto",token:function(t){_(e,t)}}),n=e.find('input[name="first_name"]').val().trim(),i=e.find('input[name="last_name"]').val().trim(),o=e.find('input[name="email"]').val().trim(),r=e.find('input[name="currency"]').val().trim(),s=0;s=e.find('input[name="pay_all"]').is(":checked")?e.find('input[name="total_price"]').val():e.find('input[name="total_advance"]').val(),a.open({name:n+" "+i,description:o,currency:r,amount:100*s})}function _(t,a){var n={},o=t.serializeArray(),r=t.find('button[type="submit"]');e.each(o,function(e,t){n[t.name]=t.value}),e.extend(a,n),e.ajax({url:hotel_settings.ajax,data:a,type:"POST",dataType:"html",beforeSend:function(){r.addClass("hb_loading")}}).done(function(e){r.removeClass("hb_loading"),e=i(e),"undefined"!=typeof e.result&&"success"==e.result?"undefined"!=typeof e.redirect&&(window.location.href=e.redirect):"undefined"!=typeof e.message&&alert(e.message)}).fail(function(){r.removeClass("hb_loading")})}function l(t){var a=window.location.href.replace(/\?.*/,"");t.attr("action",a);var n=t.find('button[type="submit"]');return t.triggerHandler("hotel_booking_place_order")!==!1&&e.ajax({type:"POST",url:hotel_settings.ajax,data:t.serialize(),dataType:"text",beforeSend:function(){n.addClass("hb_loading")},success:function(e){n.removeClass("hb_loading");try{var t=i(e);"success"==t.result?void 0!=t.redirect&&(window.location.href=t.redirect):"undefined"!=typeof t.message&&alert(t.message)}catch(a){alert(a)}},error:function(){n.removeClass("hb_loading"),r([hotel_booking_i18n.waring.try_again])}}),!1}function c(){var t=e('input[name="hb-coupon-code"]'),a=t.parents("table");return t.val()?void e.ajax({type:"POST",url:hotel_settings.ajax,data:{action:"hotel_booking_apply_coupon",code:t.val()},dataType:"text",beforeSend:function(){a.hb_overlay_ajax_start()},success:function(e){a.hb_overlay_ajax_stop();try{var t=i(e);"success"==t.result?window.location.href=window.location.href:alert(t.message)}catch(n){alert(n)}},error:function(){a.hb_overlay_ajax_stop(),alert("error")}}):(alert(hotel_booking_i18n.enter_coupon_code),t.focus(),!1)}var h=e(document);void 0==Date.prototype.compareWith&&(Date.prototype.compareWith=function(e){"string"==typeof e&&(e=new Date(e));var t=parseInt(this.getTime()/1e3),a=parseInt(e.getTime()/1e3);return t>a?1:a>t?-1:0}),HB_Booking_Cart={init:function(){this.add_to_cart(),this.remove_cart()},hb_add_to_cart_callback:function(t,a){var n=e(".hotel_booking_mini_cart"),i=n.length,o=wp.template("hb-minicart-item");if(o=o(t),0!==i){for(var r=0;i>r;r++){var s=e(n[r]),d=e(n[r]).find(".hb_mini_cart_item"),_=!1,l=s.find(".hb_mini_cart_empty"),c=s.find(".hb_mini_cart_footer"),h=d.length;if(0===h){var m=wp.template("hb-minicart-footer");1===l.length?(l.after(m({})),l.before(o)):c.before(o),_=!0;break}for(var u=0;h>u;u++){var f=e(d[u]),p=f.attr("data-cart-id");if(t.cart_id===p){f.replaceWith(o),_=!0;break}}_===!1&&c.before(o)}e(".hb_mini_cart_empty").remove();var v=setTimeout(function(){e(".hb_mini_cart_item").removeClass("active"),clearTimeout(v)},3500);"undefined"!=typeof a&&a()}},hb_remove_cart_item_callback:function(t,a){for(var n=e(".hotel_booking_mini_cart"),i=0;i<n.length;i++){for(var o=e(n[i]),r=o.find(".hb_mini_cart_item"),s=0;s<r.length;s++){var d=e(r[s]),_=d.attr("data-cart-id");if(t===_){d.remove();break}}if(r=o.find(".hb_mini_cart_item"),0===r.length){var l=wp.template("hb-minicart-empty");o.find(".hb_mini_cart_footer").remove(),o.append(l({}));break}}for(var c=e("#hotel-booking-payment, #hotel-booking-cart"),i=0;i<c.length;i++){for(var h=e(c[i]),m=h.find("table").find(".hb_checkout_item, .hb_addition_services_title"),s=0;s<m.length;s++){var u=e(m[s]);_=u.attr("data-cart-id"),parent_item_id=u.attr("data-parent-id"),t!==_&&t!==parent_item_id||u.remove()}"undefined"!=typeof a.sub_total&&h.find("span.hb_sub_total_value").html(a.sub_total),"undefined"!=typeof a.grand_total&&h.find("span.hb_grand_total_value").html(a.grand_total),"undefined"!=typeof a.advance_payment&&h.find("span.hb_advance_payment_value").html(a.advance_payment)}},add_to_cart:function(){e("form.hb-search-room-results");e(document).on("submit","form.hb-search-room-results",function(t){t.preventDefault();var a=e(this),n=a.find(".hb_add_to_cart"),o=a.find(".number_room_select"),r=a.find(".number_room_select option:selected").val(),s=a.find(".hb-room-name");if(e(".number_room_select").removeClass("hotel_booking_invalid_quantity"),"undefined"==typeof r||""===r){o.addClass("hotel_booking_invalid_quantity"),s.find(".hb_success_message").remove(),s.append('<label class="hb_success_message">'+hotel_booking_i18n.waring.room_select+"</label>");{setTimeout(function(){s.find(".hb_success_message").remove()},2e3)}return!1}var d=e(this).serializeArray();return e.ajax({url:hotel_settings.ajax,type:"POST",data:d,dataType:"html",beforeSend:function(){n.addClass("hb_loading")},success:function(e){if(a.hb_overlay_ajax_stop(),e=i(e),"undefined"!=typeof e.message){s.find(".hb_success_message").remove(),s.append(e.message);{setTimeout(function(){s.find(".hb_success_message").remove()},3e3)}}"undefined"!=typeof e.status&&"success"===e.status?"undefined"!=typeof e.redirect&&(window.location.href=e.redirect):alert(e.message),"undefined"!=typeof e.id&&HB_Booking_Cart.hb_add_to_cart_callback(e),n.removeClass("hb_loading")},error:function(){n.removeClass("hb_loading"),alert(hotel_booking_i18n.waring.try_again)}}),!1})},remove_cart:function(){e(document).on("click",".hb_remove_cart_item",function(t){t.preventDefault();var a=e(this).parents("tr"),n=e(this).attr("data-cart-id");e.ajax({url:hotel_settings.ajax,type:"POST",data:{cart_id:n,nonce:hotel_settings.nonce,action:"hotel_booking_ajax_remove_item_cart"},dataType:"html",beforeSend:function(){a.hb_overlay_ajax_start()}}).done(function(t){t=i(t),("undefined"==typeof t.status||"success"!==t.status)&&alert(hotel_booking_i18n.waring.try_again),"undefined"!=typeof t.sub_total&&e("span.hb_sub_total_value").html(t.sub_total),"undefined"!=typeof t.grand_total&&e("span.hb_grand_total_value").html(t.grand_total),"undefined"!=typeof t.advance_payment&&e("span.hb_advance_payment_value").html(t.advance_payment),a.hb_overlay_ajax_stop(),a.remove(),HB_Booking_Cart.hb_remove_cart_item_callback(n,t)})}),e(".hotel_booking_mini_cart").on("click",".hb_mini_cart_remove",function(t){t.preventDefault();var a=(e(".hotel_booking_mini_cart"),e(this).parents(".hb_mini_cart_item")),n=a.attr("data-cart-id");e.ajax({url:hotel_settings.ajax,type:"POST",data:{cart_id:n,nonce:hotel_settings.nonce,action:"hotel_booking_ajax_remove_item_cart"},dataType:"html",beforeSend:function(){a.addClass("before_remove"),a.hb_overlay_ajax_start()}}).done(function(e){return e=i(e),"undefined"==typeof e.status||"success"!==e.status?void alert(hotel_booking_i18n.waring.try_again):(HB_Booking_Cart.hb_remove_cart_item_callback(n,e),void a.hb_overlay_ajax_stop())})})}},e(document).ready(function(){HB_Booking_Cart.init(),e.datepicker.setDefaults({dateFormat:hotel_booking_i18n.date_time_format});var a=new Date,r=new Date,_=e(document).triggerHandler("hotel_booking_min_check_in_date",[1,a,r]);t(_)||(_=1),r.setDate(a.getDate()+_),e('input[id^="check_in_date"]').datepicker({dateFormat:hotel_booking_i18n.date_time_format,monthNames:hotel_booking_i18n.monthNames,monthNamesShort:hotel_booking_i18n.monthNamesShort,dayNames:hotel_booking_i18n.dayNames,dayNamesShort:hotel_booking_i18n.dayNamesShort,dayNamesMin:hotel_booking_i18n.dayNamesMin,minDate:r,maxDate:"+365D",numberOfMonths:1,onSelect:function(){var n=e(this).attr("id");n=n.replace("check_in_date_","");var i=e(this).datepicker("getDate"),o=e(document).triggerHandler("hotel_booking_range_check_in_check_out",[1,a,r]);t(o)||(o=1),i&&i.setDate(i.getDate()+o);var s=e("#check_out_date_"+n);s.datepicker("option","minDate",i)}}),e('input[id^="check_out_date"]').datepicker({dateFormat:hotel_booking_i18n.date_time_format,monthNames:hotel_booking_i18n.monthNames,monthNamesShort:hotel_booking_i18n.monthNamesShort,dayNames:hotel_booking_i18n.dayNames,dayNamesShort:hotel_booking_i18n.dayNamesShort,dayNamesMin:hotel_booking_i18n.dayNamesMin,minDate:r,maxDate:"+365D",numberOfMonths:1,onSelect:function(){var n=e(this).attr("id");n=n.replace("check_out_date_","");var i=e("#check_in_date_"+n),o=e(this).datepicker("getDate"),s=e(document).triggerHandler("hotel_booking_range_check_in_check_out",[1,a,r]);t(s)||(s=1),o.setDate(o.getDate()-s),i.datepicker("option","maxDate",o)}}),e("#datepickerImage").click(function(){e("#txtFromDate").datepicker("show")}),e("#datepickerImage1").click(function(){e("#txtToDate").datepicker("show")}),e('form[class^="hb-search-form"]').submit(function(t){t.preventDefault();var a=e(this),o=a.attr("class"),r=a.find('button[type="submit"]');o=o.replace("hb-search-form-",""),a.find("input, select").removeClass("error");var s=e("#check_in_date_"+o);if(""===s.val()||!n(s.datepicker("getDate")))return s.addClass("error"),!1;var d=e("#check_out_date_"+o);if(""===d.val()||!n(d.datepicker("getDate")))return d.addClass("error"),!1;if(null===s.datepicker("getDate"))return s.addClass("error"),!1;if(null===d.datepicker("getDate"))return d.addClass("error"),!1;var _=new Date(s.datepicker("getDate")),l=new Date(d.datepicker("getDate")),c=new Date;if(-1==_.compareWith(c))return s.addClass("error"),!1;if(_.compareWith(l)>=0)return s.addClass("error"),error=!0,!1;for(var h=e(this).attr("action")||window.location.href,m=e(this).serializeArray(),u=0;u<m.length;u++){var f=m[u];if("check_in_date"===f.name||"check_out_date"===f.name){var p=e(this).find('input[name="'+f.name+'"]').datepicker("getDate");p=new Date(p),m.push({name:"hb_"+f.name,value:p.getTime()/1e3-60*p.getTimezoneOffset()})}}return e.ajax({url:hotel_settings.ajax,type:"post",dataType:"html",data:m,beforeSend:function(){r.addClass("hb_loading")},success:function(e){e=i(e),"undefined"!=typeof e.success&&e.success&&("undefined"!=typeof e.url?window.location.href=e.url:e.sig&&(h+=-1===h.indexOf("?")?"?hotel-booking-params="+e.sig:"&hotel-booking-params="+e.sig,window.location.href=h))}}),!1}),e("form#hb-payment-form").submit(function(t){t.preventDefault();var a=e(this),n=a.find('input[name="hb-payment-method"]:checked').val(),i=window.location.href.replace(/\?.*/,"");a.find(".hotel_checkout_errors").slideUp().remove(),a.find("input, select").parents("div:first-child").removeClass("error");try{if(a.triggerHandler("hb_order_submit")===!1)return!1;if(a.attr("action",i),!s(a))return!1;"stripe"===n?d(a):l(a)}catch(t){alert(t)}}),e("#fetch-customer-info").click(o),h.on("click",".hb-view-booking-room-details, .hb_search_room_item_detail_price_close",function(t){t.preventDefault();var a=e(this),n=a.parents(".hb-room-content").find(".hb-booking-room-details");n.toggleClass("active")}).on("click",'input[name="hb-payment-method"]',function(){this.checked&&(e(".hb-payment-method-form:not(."+this.value+")").slideUp(),e(".hb-payment-method-form."+this.value).slideDown())}).on("click","#hb-apply-coupon",function(){c()}).on("click","#hb-remove-coupon",function(t){t.preventDefault();var a=e(this).parents("table");e.ajax({url:hotel_settings.ajax,type:"post",dataType:"html",data:{action:"hotel_booking_remove_coupon"},beforeSend:function(){a.hb_overlay_ajax_start()},success:function(e){a.hb_overlay_ajax_stop(),e=i(e),"success"==e.result&&(window.location.href=window.location.href)}})});var m=e(".hb_single_room_details"),u=m.find(".hb_single_room_tabs"),f=m.find(".hb_single_room_tabs_content"),p=e(".hb_single_room_tab_details"),v=window.location.href,g=v.match(/\#comment-[0-9]+/gi);g&&"undefined"!=typeof g[0]?(u.find("a").removeClass("active"),u.find('a[href="#hb_room_reviews"]').addClass("active")):(u.find("a:first").addClass("active"),e(".hb_single_room_tabs_content .hb_single_room_tab_details:not(:first)").hide()),p.hide();var b=u.find("a.active").attr("href");f.find(b).fadeIn(),u.find("a").on("click",function(t){t.preventDefault(),u.find("a").removeClass("active"),e(this).addClass("active");var a=e(this).attr("href");return p.hide(),f.find(a).fadeIn(),!1}),e(".hb-rating-input").rating(),e("#commentform").submit(function(){var t=e("#rating"),a=t.val();return 1===t.length&&"undefined"!=typeof a&&""===a?(window.alert(hotel_booking_i18n.review_rating_required),!1):void e(this).submit()})}),e.fn.rating=function(){for(var t=this,a=this.length,n=0;a>n;n++){var i=e(t[n]),o=[];o.push('<span class="rating-input" data-rating="1"></span>'),o.push('<span class="rating-input" data-rating="2"></span>'),o.push('<span class="rating-input" data-rating="3"></span>'),o.push('<span class="rating-input" data-rating="4"></span>'),o.push('<span class="rating-input" data-rating="5"></span>'),o.push('<input name="rating" id="rating" type="hidden" value="" />'),i.html(o.join("")),i.mousemove(function(a){a.preventDefault();for(var n=t.offset(),i=a.pageX-n.left,o=e(this).find(".rating-input"),r=o.width(),s=Math.ceil(i/r),d=0;d<o.length;d++){var _=e(o[d]),l=parseInt(_.attr("data-rating"));s>=l&&_.addClass("high-light")}}).mouseout(function(a){var n=t.offset(),i=(a.pageX-n.left,e(this).find(".rating-input")),o=(i.width(),e(this).find(".rating-input.selected"));if(0===o.length)i.removeClass("high-light");else for(var r=0;r<i.length;r++){var s=e(i[r]),d=parseInt(s.attr("data-rating"));d<=parseInt(o.attr("data-rating"))?s.addClass("high-light"):s.removeClass("high-light")}}).mousedown(function(a){var n=t.offset(),o=a.pageX-n.left,r=e(this).find(".rating-input"),s=r.width(),d=Math.ceil(o/s);r.removeClass("selected").removeClass("high-light");for(var _=0;_<r.length;_++){var l=e(r[_]),c=parseInt(l.attr("data-rating"));if(c===d){l.addClass("selected").addClass("high-light");break}l.addClass("high-light")}i.find('input[name="rating"]').val(d)})}},e.fn.hb_overlay_ajax_start=function(){var e=this;e.css({position:"relative",overflow:"hidden"});var t='<div class="hb_overlay_ajax">';t+="</div>",e.append(t)},e.fn.hb_overlay_ajax_stop=function(){var e=this,t=e.find(".hb_overlay_ajax");t.addClass("hide");var a=setTimeout(function(){t.remove(),clearTimeout(a)},400)}}(jQuery);